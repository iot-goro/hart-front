<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>WebSocket</title>
</head>

<body>
    <p id="output"></p>

    <script>
        // uuid を生成する
        let wsid = crypto.randomUUID();

        // uuid が保存されていない場合
        if (!localStorage.getItem('wsid')) {
            localStorage.setItem('wsid', wsid);
        }

        // uuid を取得する
        wsid = localStorage.getItem('wsid');

        function ConnectWs() {
            let ws = new WebSocket("wss://iot-hart.tail6cf7b.ts.net:8350/app/ws")

            ws.onopen = function () {
                console.log('Connected');

                // 接続IDを送る
                ws.send(wsid);
            }

            ws.onmessage = function (evt) {
                var out = document.getElementById('output');
                out.innerHTML += evt.data + '<br>';
            };

            ws.onclose = function () {
                console.log('Disconnected');
                // 再接続
                setTimeout(() => {
                    ConnectWs();
                }, 3000);
            };
        };

        ConnectWs();
    </script>
</body>

</html>